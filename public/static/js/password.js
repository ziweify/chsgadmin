var STATUS;$(function(){$(".control .button").hover(function(){$(this).toggleClass("button_hover")});if(STATUS==1){showMsg("抱歉。为安全起见，您的密码在初次登录或后台重置后，需重新设定。");return}else{if(STATUS==2){showMsg("抱歉。您的密码已超过使用期限。为安全起见，请重新设定。");return}}var a=$("#url").val();if(a){showMsg("抱歉。为安全起见，您的密码需重新设定。");return}});function check(d,c,b){for(var e=0,a=c.length-b;e<=a;e++){if(d.indexOf(c.substr(e,b))!=-1){return false}}return true}function testPassword(a){if(!check(a,"123456789",4)){return true}if(!check(a,"987654321",4)){return true}if(/^[a-z]+$/.test(a)||/^[0-9]+$/.test(a)){return true}return false}function showMsg(a){if(parent&&parent!=window&&parent.showMsg){parent.showMsg(a)}else{alert(a)}}function checkPassword(a,c,b,e){var d=false;if(e){if(a.length==0){showMsg("请输入原始密码！");$("#oldPassword").focus();return d}if(a===c){showMsg("新密码不能跟旧密码一样。");$("#ckPassword").focus();return d}}if(c!=b){showMsg("新设密码 和 新设密码确认 不一样！(确认大小写是否相同)");$("#ckPassword").focus();return d}if(c.length<6||c.length>20){showMsg("密码必须由6-20字符包含大小写字母和数字组合组成");$("#ckPassword").focus();return d}if(!c.match(/(.*[a-z].*)/)){showMsg("密码必须由6-20字符包含大小写字母和数字组合组成");$("#ckPassword").focus();return d}if(!c.match(/(.*[A-Z].*)/)){showMsg("密码必须由6-20字符包含大小写字母和数字组合组成");$("#ckPassword").focus();return d}if(!c.match(/(.*\d.*)/)){showMsg("密码必须由6-20字符包含大小写字母和数字组合组成");$("#ckPassword").focus();return d}if(/.*[^\x21-\x7E].*/.test(c)){showMsg("密码不可以包含空格，中文符号或特殊符号");$("#ckPassword").focus();return d}if(!confirm("是否确定要修改密码？")){return d}return true}function changePassword(){var a=$("#oldPassword").val();var c=$("#password").val();var b=$("#ckPassword").val();var d=checkPassword(a,c,b,true);if(!d){return}$.post("changePassword",{oldPassword:a,password:c},function(e){if(e.success){alert("密码修改成功。");if(e.data==true&&window.top.location.href.indexOf("agent/password?url=login")!==-1){alert("安全登录个人二次验证：登录双重防护，更好的保障您的账户安全！\n为提高您的账户安全性，建议您通过设置个人管理里的“个人二次验证”，为您的账户再添加一道安全防护屏障。\n")}window.top.location.href="../login"}else{showMsg(e.message);$("#oldPassword").focus()}})}function changeTransferPassword(){var a=$("#oldPassword").val();var c=$("#password").val();var b=$("#ckPassword").val();var d=checkPassword(a,c,b,true);if(!d){return}$.post("changeTransferPassword",{oldPassword:a,password:c},function(e){if(e.success){alert("转账密码修改成功。")}else{showMsg(e.message);$("#oldPassword").focus()}})}function openSetupTransferPassword(c,b){var a=$("#setupTransferPasswordDialogue");if(a.length==0){a=$('<div id="setupTransferPasswordDialogue">').addClass("popdiv");a.dialog({autoOpen:false,width:550})}a.dialog("option",{title:"设置转账密码"});a.empty();a.append('<table class="list data_table info_table"><tr><th>转账密码</th><td><input id="transferPassword" type="password" class="input" /></td></tr><tr><th>确认转账密码</th><td><input id="ckTransferPassword" type="password" class="input" /></td></tr></table><div style="position:absolute;right:20px;bottom:20px;"><input id="setupOk" type="button" value="确定" /></div>');a.dialog("open");$("#setupOk").click(function(){$("#setupTransferPasswordDialogue").dialog("close");var d=$("input[id='transferPassword']").val();if(d==null||d.trim()==""){alert("请输入转账密码！");return}setupTransferPassword(c,b,"openResetTransferPasswordDialog")})}function setupTransferPassword(f,c,e){var b=$("#transferPassword").val();var a=$("#ckTransferPassword").val();var d=checkPassword("",b,a,false);if(!d){return}$.post("/agent/setupTransferPassword",{transferPassword:b},function(h){if(h.success){alert("转账密码设置成功。");var g=window[e];if(typeof g==="function"){g(f,c)}}else{showMsg(h.message);$("#transferPassword").focus()}})}function openResetTransferPasswordDialog(c,b){var a=$("#resetTransferPasswordDialogue");if(a.length==0){a=$('<div id="resetTransferPasswordDialogue">').addClass("popdiv");a.dialog({autoOpen:false,width:550})}a.dialog("option",{title:"请输入转账密码"});a.empty();a.append('<table class="list data_table info_table"><tr><th>转账密码</th><td><input id="inputResetTransferPassword" type="password" class="input" /></td></tr></table><div style="position:absolute;right:20px;bottom:20px;"><input id="resetOk" type="button" value="确定" /></div>');a.dialog("open");$("#resetOk").click(function(){$("#resetTransferPasswordDialogue").dialog("close");var d=$("input[id='inputResetTransferPassword']").val();if(d==null||d.trim()==""){alert("请输入转账密码！");return}resetTransferPassword(c,d,b)})}function resetTransferPassword(c,a,b){if(!confirm("是否确定重置转账密码？")){return}$.ajax({url:"resetTransferPassword",type:"POST",loading:true,data:{username:c,transferPassword:a,isMain:b},success:function(d){if(d&&d.success){alert("成功重置转账密码。");location.href=location.href}else{if(d){alert("重置失败："+d.message)}}},error:function(){alert("重置失败，内部错误。")}})};